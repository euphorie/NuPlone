<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:meta="http://xml.zope.org/namespaces/meta"
      meta:interpolation="true"
      i18n:domain="nuplone"
      tal:define="tools context/@@tools; factories view/factories">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" tal:attributes="src tools/portal/++resource++NuPlone.libraries/css_browser_selector.js"></script>
    <link rel="stylesheet" type="text/css" media="all" tal:attributes="href string:${tools/portal/++resource++NuPlone.style/main}/base.css" />
    <title i18n:translate="title_site_menu">Site menu</title>
    <base target="_parent"/>
  </head>
  <body class="siteMenu">
    <ul class="menu" id="siteMenu">
      <li id="user" tal:condition="tools/anonymous">
        <a href="${tools/navroot_url}/@@login?came_from=${request/environ/HTTP_REFERER|context/absolute_url}" i18n:translate="menu_login">Login</a>
      </li>
      <li id="user" tal:condition="not:tools/anonymous">
        <a href="#">${python:tools.user.getProperty('fullname', '') or tools.user.getUserName()}</a>
        <ul>
          <li>
            <ul>
              <li>
                <a href="${tools/portal_url}/@@logout" i18n:translate="menu_logout">Log out</a>
              </li>
              <li>
                <a href="${view/settings_url}" i18n:translate="menu_settings">Settings</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <tal:block condition="python:view.view_type=='view' and (factories or view.can_copy or view.can_cut or view.can_paste or view.can_delete)">
        <li>
          <a href="#" i18n:translate="menu_actions">Actions</a>
          <ul tal:define="factories factories">
            <li tal:condition="python:factories"><tal:span i18n:translate="menu_add_new">Add new</tal:span>
              <ul>
                <li tal:repeat="factory factories">
                  <a href="${factory/url}" title="${factory/description}" >${factory/title}</a>
                </li>
              </ul>
            </li>
            <li tal:condition="python:view.can_copy or view.can_cut or view.can_paste or view.can_delete"><tal:span i18n:translate="menu_organise">Organise</tal:span>
              <ul>
                <li tal:condition="view/can_copy">
                  <a href="${tools/context_url}/@@copy" i18n:translate="menu_copy">Copy</a>
                </li>
                <li tal:condition="view/can_cut">
                  <a href="${tools/context_url}/@@cut" i18n:translate="menu_cut">Cut</a>
                </li>
                <li tal:condition="view/can_paste">
                  <a href="${tools/context_url}/@@paste" i18n:translate="menu_paste">Paste</a>
                </li>
                <li tal:condition="view/can_delete">
                  <a href="${tools/context_url}/@@delete" i18n:translate="menu_delete">Delete</a>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li tal:condition="permission:Modify portal content">
          <a href="${context/absolute_url}/@@edit" i18n:translate="menu_edit">Edit</a>
        </li>
      </tal:block>
    </ul>

  <script type="text/javascript" tal:attributes="src tools/portal/++resource++NuPlone.libraries/jquery-1.4.2.js"></script>
  <script type="text/javascript" tal:attributes="src tools/portal/++resource++NuPlone.behaviour/behaviour.js"></script>
  <script type="text/javascript" meta:interpolation="false">
var sitemenu = {
    // Timer to control hiding of the sitemenu in the main document
    timer: null,

    getIframeElement: function() {
        var contentDoc = window.frameElement.ownerDocument,
            $iframe = $("#siteMenu", contentDoc);
        return $iframe;
    },

    clearTimer: function() {
        if (sitemenu.timer) {
            clearTimeout(sitemenu.timer);
            sitemenu.timer = null;
        }
    },

    setTimer: function() {
        if (sitemenu.timer) {
            return;
        }

        sitemenu.timer = setTimeout(function() {
            sitemenu.getIframeElement().css("height", null);
            }, 1000);
    },

    init: function() {
        $("#siteMenu").live("mouseover", function(e) {
            if (!sitemenu.clearTimer()) {
                sitemenu.getIframeElement().css("height", "100%");
            }
        });

        $("#siteMenu").live("mouseout", function(e) {
            sitemenu.clearTimer();
            sitemenu.setTimer();
        });
    }
};

sitemenu.init();
  </script>
  </body>
</html>

